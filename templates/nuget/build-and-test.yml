parameters:
  dotnetSdkVersion: ""
  dotnetRuntimeVersions: []
  outOfProcessTestDependencies: ""
  buildConfiguration: "Release"
  codecovKey: ""
  runCodeCoverage: true
  extraArguments: ""

steps:
- template: "install-dotnet.yml"
  parameters:
    dotnetSdkVersion: ${{parameters.dotnetSdkVersion}}
    dotnetRuntimeVersions: ${{parameters.dotnetRuntimeVersions}}
- ${{if containsValue(parameters.outOfProcessTestDependencies, 'ffmpeg')}}:
  - template: "../shared/install-ffmpeg.yml"
- script: "dotnet test -v n --configuration ${{parameters.buildConfiguration}} -p:CollectCoverage=${{parameters.runCodeCoverage}} -p:CoverletOutputFormat=cobertura ${{ parameters.extraArguments }}"
  displayName: "RestoreBuildAndTest"
  env:
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
    DOTNET_CLI_TELEMETRY_OPTOUT: true
- ${{if eq(parameters.runCodeCoverage, 'true')}}:
  - template: "publish-code-coverage-reports.yml"
    parameters:
      codecovKey: ${{parameters.codecovKey}}
      runCodeCoverage: ${{parameters.runCodeCoverage}}