parameters:
  buildConfiguration: ""
  targetFramework: ""
  runCodeCoverage: "false"

steps:
- checkout: "none"
- template: "../shared/download-working-directory.yml"
- task: "DotNetCoreCLI@2"
  displayName: "Test"
  inputs:
    command: "test"
    projects: "test/**/*.csproj"
    # TODO Figure out how to run .Net Framework test assemblies on Linux/macOS using mono. For now, only allow target framework to be specified so that
    # we can run only .Net Core test assemblies on Linux/macOS.
    arguments: "--framework ${{ parameters.targetFramework }} --no-restore --no-build --configuration ${{parameters.buildConfiguration}} -p:CollectCoverage=${{parameters.runCodeCoverage}} -p:CoverletOutputFormat=cobertura"
  # Skip dotnet first time experience
  env:
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
    # Make sure dotnet knows to look for packages in ./packages
    NUGET_PACKAGES: $(system.defaultWorkingDirectory)/packages