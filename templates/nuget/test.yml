parameters:
  buildConfiguration: ""
  extraArguments: ""
  runCodeCoverage: "false"
  dotnetSdkVersion: ""
  dotnetRuntimeVersions: []
  outOfProcessTestDependencies: []

steps:
- checkout: "none"
- template: "../shared/download-working-directory.yml"
- template: "install-dotnet.yml"
  parameters:
    dotnetSdkVersion: ${{parameters.dotnetSdkVersion}}
    dotnetRuntimeVersions: ${{parameters.dotnetRuntimeVersions}}
- ${{if containsValue(parameters.outOfProcessTestDependencies, 'ffmpeg')}}:
  - template: "../shared/install-ffmpeg.yml"
# We need to restore so that tools like coverlet and Microsoft.Net.Test.SDK are available
- task: "DotNetCoreCLI@2"
  displayName: "Restore"
  inputs:
    command: "restore"
  # Skip dotnet first time experience
  env:
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
- task: "DotNetCoreCLI@2"
  displayName: "Test"
  inputs:
    command: "test"
    projects: "test/**/*.csproj"
    arguments: "--no-restore --no-build --configuration ${{parameters.buildConfiguration}} -p:CollectCoverage=${{parameters.runCodeCoverage}} -p:CoverletOutputFormat=cobertura ${{ parameters.extraArguments }}"